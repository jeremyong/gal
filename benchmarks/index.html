<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GAL - A fast C++17 geometric algebra library">
    <meta name="author" content="Jeremy Ong">
    <link rel="canonical" href="https://jeremyong.com/gal/benchmarks/">
    <link rel="../img/favicon.ico">

    
    <title>Benchmarks - GAL</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">
    <link href="../css/highlight.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-10576233-1', 'jeremyong.com');
    ga('send', 'pageview');
    </script>
    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">GAL</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Quick Start</a>
                    </li>
                
                
                
                    <li >
                        <a href="../optimizations/">Optimizations</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Benchmarks</a>
                    </li>
                
                
                
                    <li >
                        <a href="../coding-conventions/">Coding Conventions</a>
                    </li>
                
                
                
                    <li >
                        <a href="../about/">About</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li >
                        <a rel="prev" href="../optimizations/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../coding-conventions/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/jeremyong/gal/edit/master/docs/benchmarks.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#benchmarks">Benchmarks</a></li>
            <li class="second-level"><a href="#runtime">Runtime</a></li>
                
            <li class="second-level"><a href="#compilation-time">Compilation time</a></li>
                
            <li class="second-level"><a href="#file-size">File size</a></li>
                
            <li class="second-level"><a href="#notes-for-reproducing-the-benchmark">Notes for reproducing the benchmark</a></li>
                
            <li class="second-level"><a href="#roadmap">Roadmap</a></li>
                
            <li class="second-level"><a href="#note-to-other-library-authors">Note to other library authors</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="benchmarks">Benchmarks</h1>
<blockquote>
<p>NOTE: The author isn't honestly a believer in benchmarks as a proxy for how fast <em>your</em> code will run. Use these timings only as a heuristic on which to base your judgement and please, please, benchmark your own code. If you find something isn't fast, please file an issue! Thanks :)</p>
</blockquote>
<p>These results were produced on October 28, 2019 for the <code>GABenchmark_AlgorithmInverseKinematics_ConformalModel_D3</code> benchmark provided by <a href="https://github.com/ga-developers/ga-benchmark/blob/master/AlgorithmInverseKinematics.cpp">gabenchmark</a> (all benchmarks compiled with <code>-O2 -mfma</code> using GCC 10). Prior to each benchmark, CPU scaling was turned off for consistent results.</p>
<p>For possible explanations to explain both the compile-time and runtime behavior of GAL, please refer to the <a href="../optimizations/">optimizations</a> section of this page.</p>
<h2 id="runtime">Runtime</h2>
<table>
<thead>
<tr>
<th>Library</th>
<th>Commit Hash</th>
<th>Time</th>
<th>Iterations</th>
<th>Iterations/ns (higher is better)</th>
<th>Speedup (higher is better)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/wolftype/versor">Versor</a></td>
<td><a href="https://github.com/wolftype/versor/commit/2c5b455187a162bd429a3acf6ffd2f06fb4732ab">2c5b455</a></td>
<td>1138 ns</td>
<td>608337</td>
<td>535/ns</td>
<td>1x</td>
</tr>
<tr>
<td><a href="https://github.com/laffernandes/gatl">GATL</a></td>
<td><a href="https://github.com/laffernandes/gatl/commit/c47ad5d13c18f0116797d1ea614557cca5e99bb3">c47ad5</a></td>
<td>469 ns</td>
<td>1505207</td>
<td>3209/ns</td>
<td>5.998x</td>
</tr>
<tr>
<td><a href="https://github.com/jeremyong/gal">GAL</a></td>
<td><a href="https://github.com/jeremyong/gal/commit/e3f49ae28680a89d328b2d37320fe61773c41b56">e3f49ae</a></td>
<td>376 ns</td>
<td>1873236</td>
<td><strong>4982/ns</strong></td>
<td><strong>9.312x</strong></td>
</tr>
</tbody>
</table>
<p>This was tested on an Intel i9-9900K. The variable runtime is due to the way <a href="https://github.com/google/benchmark">google/benchmark</a> works. It will keep running new iterations until the statistical significance of the measurement increases above a predetermined amount. The important metric is the rate in the fourth column. The speedup factor in the final column is computed as the ratio to the throughput of Versor (first row).</p>
<h2 id="compilation-time">Compilation time</h2>
<p>The compilation times for the same example are shown below:</p>
<table>
<thead>
<tr>
<th>Compiler</th>
<th>Library</th>
<th>Compile Time (lower is better)</th>
</tr>
</thead>
<tbody>
<tr>
<td>g++ (GCC) 10.0.0 20191012 (experimental)</td>
<td>Versor</td>
<td><strong>5.50 s</strong></td>
</tr>
<tr>
<td>g++ (GCC) 10.0.0 20191012 (experimental)</td>
<td>GATL</td>
<td>20.38 s</td>
</tr>
<tr>
<td>g++ (GCC) 10.0.0 20191012 (experimental)</td>
<td>GAL</td>
<td>12.30 s</td>
</tr>
<tr>
<td>clang++ 9.0.0</td>
<td>Versor</td>
<td><strong>3.47 s</strong></td>
</tr>
<tr>
<td>clang++ 9.0.0</td>
<td>GATL</td>
<td><em>could not compile</em><sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></td>
</tr>
<tr>
<td>clang++ 9.0.0</td>
<td>GAL</td>
<td>7.19 s</td>
</tr>
</tbody>
</table>
<p>As with the benchmark, CPU scaling was turned off for the test and all compilations were run from a clean build folder. As you can see, GAL doesn't compile the fastest, but does enjoy an edge over GATL due to the availability of <code>constexpr</code> at the time of authorship to avoid slow-to-compile techniques like SFINAE (<code>std::enable_if</code>). Improving compilation time (or at the very least) not regressing is a constant goal for GAL.</p>
<h2 id="file-size">File size</h2>
<p>The file size of the compiled test can be a useful indicator of future bloat if used in your library or application. Obviously, you will need to measure this in your own code since the final size may not scale in any predictable way.</p>
<p>The sizes of various segments (<code>.strtab</code>, <code>.text</code>, and <code>.symtab</code>) are included as an indication of what bloat may be attributed to. Smaller sections are omitted for brevity. Also, note that the raw sizes are obviously more important than the percentages. Statistics were taken by using the <a href="https://github.com/google/bloaty">google/bloaty</a> ELF parser.</p>
<table>
<thead>
<tr>
<th>Library</th>
<th>File size (lower is better)</th>
<th><code>.strtab</code></th>
<th><code>.text</code></th>
<th><code>.symtab</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Versor</td>
<td>282.7 kB</td>
<td>92.2 kB (32.6%)</td>
<td>157 kB (55.8%)</td>
<td>7.88 kB (2.8%)</td>
</tr>
<tr>
<td>GATL</td>
<td>72.2 kB</td>
<td>42.2 kB (58.5%)</td>
<td>12.9 kB (17.8%)</td>
<td>3.52 kB (4.9%)</td>
</tr>
<tr>
<td>GAL</td>
<td><strong>26.5 kB</strong></td>
<td><strong>1.85 kB</strong> (7.0%)</td>
<td><strong>9.9 kB</strong> (37.4%)</td>
<td><strong>2.18 kB</strong> (8.2%)</td>
</tr>
</tbody>
</table>
<p>GAL tries very hard not to include headers unnecessarily which has an impact both on compile times and executable bloat.</p>
<p>For reference, the <code>.strtab</code> segment refers to the string table (stores null-terminated strings). The <code>.text</code> segment refers to the code segment, and the <code>.symtab</code> refers to the symbol table (needed to relocate symbols and references).</p>
<blockquote>
<p>NOTE: the file sizes above include the benchmarking code, so your file savings may be even more dramatic (but no guarantees can be made).</p>
</blockquote>
<h2 id="notes-for-reproducing-the-benchmark">Notes for reproducing the benchmark</h2>
<ul>
<li>GAL provides a mechanism for specifying arbitrary multivectors as types with exact rational coefficients. This means that the conformal point located at <script type="math/tex">(1, 0, 0)</script>, represented by <script type="math/tex">\mathbf{o} + e_2 + \frac{1}{2}\boldsymbol\infty</script> can be represented exactly as opposed to the canonical point representation with <script type="math/tex">p_x = p_y = 0.0</script> being stored and computed with floating point zeros.</li>
<li>When this optimization was made, all results were completely accurate up till the final reference value for <code>Jg_f[4]</code> for which the published result should be <code>3.31122e6</code>. Instead, GAL computes <code>1.831977e6</code> for this entry. Reintroducing floating point zeros into the expression immediately recovers the reference result, indicating that this lone result is likely incorrect as stated.</li>
<li>A check of all 16 other reference results though matches identically (all of which are in more reasonable floating point ranges).</li>
<li>To compile the GATL implementation of the algorithm, two changes needed to be introduced due to a breaking change with more modern compilers in handling <code>std::enable_if_t</code>. The following snippet:</li>
</ul>
<pre><code class="c++">    // GATL lazy_context.hpp lines 652 (whitespace added here for readability on web)
    template&lt;
        typename CoefficientType,
        typename Expression,
        typename = std::enable_if_t&lt;super::stored_inputs_count() != 0&gt;&gt;
    constexpr decltype(auto)
    eval(clifford_expression&lt;CoefficientType, Expression&gt; const &amp;expression) const {
        return detail::eval&lt;
            base_id + 1,
            base_id + (detail::tag_t)super::stored_inputs_count()&gt;(
                expression, super::stored_inputs_tuple());
    }

    template&lt;
        typename CoefficientType,
        typename Expression,
        typename = std::enable_if_t&lt;super::stored_inputs_count() == 0&gt;&gt;
    constexpr decltype(auto)
    eval(clifford_expression&lt;CoefficientType, Expression&gt; &amp;&amp;) const noexcept {
        return clifford_expression&lt;CoefficientType, Expression&gt;();
    }
</code></pre>

<p>was changed to:</p>
<pre><code class="c++">    template&lt;typename CoefficientType, typename Expression&gt;
    constexpr decltype(auto)
    eval(clifford_expression&lt;CoefficientType, Expression&gt; const &amp;expression) const {
        if constexpr (super::stored_inputs_count() &gt; 0)
        {
            return detail::eval&lt;
                base_id + 1,
                base_id + (detail::tag_t)super::stored_inputs_count()&gt;(
                    expression, super::stored_inputs_tuple());
        }
        else
        {
            return clifford_expression&lt;CoefficientType, Expression&gt;();
        }
    }
</code></pre>

<ul>
<li>As this was an entirely compile-time transformation, it is not believed that either the runtime nor compilation time would be effected much. It would likely improve compilation time if anything due to the removal of an extra template instantiation in certain situations.</li>
</ul>
<h2 id="roadmap">Roadmap</h2>
<p>Benchmarking is a fine-art, and while I do not believe they should be misused, they are still helpful for identifying future areas of improvement and, perhaps more importantly, detecting regression. Because of the heavy compile-time nature of the library, small perturbations in the code can (in specific sections), cause dramatic effects downstream. A primary concern of GAL is to quickly work on getting demos working so that timings can be collected for a variety of useful workloads.</p>
<hr />
<h2 id="note-to-other-library-authors">Note to other library authors</h2>
<p>Please note that nothing on this site is intended to disparage other implementers of GA. The world needs more of them! There are certainly disadvantages of GAL at this time, namely that it is a bit less ergonomic to use at this time, and it's less battle-tested than other libraries. GAL had the benefit of being developed with newer compilers which allowed newer techniques (although there was still difficulty to be sure). In any case, I feel obligated to state a profound appreciation for the implementers and practitioners that paved a way before me.</p>
<p>If I've neglected to include a library or if you think I have made any errors, please don't hesitate to contact me and I'll make sure things get sorted. If there are situations where you think your library or code might perform better, let me know as well. Thanks!</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Because of the newer clang compiler, GATL couldn't be compiled, possibly due to changes in the C++ standard or because older versions of clang were inadvertedly more permissive. Note that for g++, I opted to test all libraries against the current trunk version, as GAL uses various C++17 techniques handled better in GCC10 and improvements to the compiler generally benefit all libraries.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Jeremy Ong 2019<br></small>
        
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
